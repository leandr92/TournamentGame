{"version":3,"sources":["../../src/server/SpaaaceServerEngine.js"],"names":["nameGenerator","require","NUM_BOTS","SpaaaceServerEngine","io","gameEngine","inputOptions","scoreData","x","makeBot","on","e","missile","ownerId","kills","ship","id","updateScore","console","log","toString","removeObjectFromWorld","isBot","setTimeout","socket","makePlayerShip","makeShip","playerId","name","socketId","playerObjects","world","queryObjects","forEach","obj","bot","attachAI","sockets","emit","ServerEngine"],"mappings":"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","sourcesContent":["import { ServerEngine } from 'lance-gg';\r\nconst nameGenerator = require('./NameGenerator');\r\nconst NUM_BOTS = 3;\r\n\r\nexport default class SpaaaceServerEngine extends ServerEngine {\r\n\r\n    constructor(io, gameEngine, inputOptions) {\r\n        super(io, gameEngine, inputOptions);\r\n        this.scoreData = {};\r\n    }\r\n\r\n    // when the game starts, create robot spaceships, and register\r\n    // on missile-hit events\r\n    start() {\r\n        super.start();\r\n\r\n        for (let x = 0; x < NUM_BOTS; x++) this.makeBot();\r\n\r\n        this.gameEngine.on('missileHit', e => {\r\n\r\n            // add kills\r\n            if (this.scoreData[e.missile.ownerId]) this.scoreData[e.missile.ownerId].kills++;\r\n\r\n            // remove score data for killed ship\r\n            delete this.scoreData[e.ship.id];\r\n            this.updateScore();\r\n\r\n            console.log(`ship killed: ${e.ship.toString()}`);\r\n            this.gameEngine.removeObjectFromWorld(e.ship.id);\r\n            if (e.ship.isBot) {\r\n                setTimeout(() => this.makeBot(), 5000);\r\n            }\r\n        });\r\n    }\r\n\r\n    // a player has connected\r\n    onPlayerConnected(socket) {\r\n        super.onPlayerConnected(socket);\r\n\r\n        let makePlayerShip = () => {\r\n            let ship = this.gameEngine.makeShip(socket.playerId);\r\n\r\n            this.scoreData[ship.id] = {\r\n                kills: 0,\r\n                name: nameGenerator('general') + \" (\" + socket.playerId + \")\"\r\n            };\r\n            this.updateScore();\r\n        };\r\n\r\n        // handle client restart requests\r\n        socket.on('requestRestart', makePlayerShip);\r\n    }\r\n\r\n    // a player has disconnected\r\n    onPlayerDisconnected(socketId, playerId) {\r\n        super.onPlayerDisconnected(socketId, playerId);\r\n\r\n\r\n        // iterate through all objects, delete those that are associated with the player (ship and missiles)\r\n        let playerObjects = this.gameEngine.world.queryObjects({ playerId: playerId });\r\n        playerObjects.forEach(obj => {\r\n            this.gameEngine.removeObjectFromWorld(obj.id);\r\n            // remove score associated with this ship\r\n            delete this.scoreData[obj.id];\r\n        });\r\n\r\n        this.updateScore();\r\n    }\r\n\r\n    // create a robot spaceship\r\n    makeBot() {\r\n        let bot = this.gameEngine.makeShip(0);\r\n        bot.attachAI();\r\n\r\n        this.scoreData[bot.id] = {\r\n            kills: 0,\r\n            name: nameGenerator('general') + 'Bot'\r\n        };\r\n\r\n        this.updateScore();\r\n    }\r\n\r\n    updateScore() {\r\n        // delay so player socket can catch up\r\n        setTimeout(() => {\r\n            this.io.sockets.emit('scoreUpdate', this.scoreData);\r\n        }, 1000);\r\n\r\n    }\r\n}"],"file":"SpaaaceServerEngine.js"}
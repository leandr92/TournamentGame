{"version":3,"sources":["../../src/client/SpaaaceRenderer.js"],"names":["PIXI","SpaaaceRenderer","gameEngine","clientEngine","require","sprites","isReady","assetPathPrefix","options","bgPhaseX","bgPhaseY","ship","missile","bg1","bg2","bg3","bg4","smokeParticle","viewportWidth","window","innerWidth","viewportHeight","innerHeight","stage","Container","layer1","layer2","addChild","document","readyState","onDOMLoaded","addEventListener","Promise","resolve","reject","loader","add","Object","keys","ASSETPATHS","map","x","name","url","load","setupStage","Utils","isTouchDevice","body","classList","isMacintosh","isWindows","emit","renderer","autoDetectRenderer","querySelector","appendChild","view","setRendererSize","lookingAt","y","camera","extras","TilingSprite","resources","texture","blendMode","BLEND_MODES","ADD","alpha","elapsedTime","Date","now","getUrlVars","graphics","Graphics","beginFill","drawRect","worldSettings","width","height","resize","t","dt","worldWidth","worldHeight","viewportSeesRightBound","viewportSeesLeftBound","viewportSeesTopBound","viewportSeesBottomBound","objId","objData","world","objects","sprite","actor","thrustEmitter","showThrust","Ship","playerShip","updateOffscreenIndicator","position","shipContainerSprite","rotation","angle","Math","PI","renderStep","cameraTarget","gameStarted","getCentroid","cameraRoam","lookingAtDeltaX","lookingAtDeltaY","cameraTempTargetX","cameraTempTargetY","centerCamera","bgOffsetX","bgOffsetY","tilePosition","render","shipSprite","tint","remove","contains","disabled","style","opacity","setTimeout","targetX","targetY","isNaN","lastCameraPosition","container","indicatorEl","createElement","setAttribute","id","console","error","playerShipObj","slope","b","padding","indicatorPos","atan2","transform","parentNode","removeChild","data","RTT","qs","innerHTML","RTTAverage","truncateDecimals","scoreContainer","scoreArray","scoreEls","querySelectorAll","length","dataset","scoreEl","parseInt","changeName","kills","push","el","sort","a","e","keyName","isDown","isInFullScreen","fullScreenElement","mozFullScreen","webkitIsFullScreen","isIPhoneIPad","docElm","documentElement","requestFullscreen","mozRequestFullScreen","webkitRequestFullScreen","obj","Renderer","maxDistance","shipCount","centroid","selectedShip","objDistance","sqrt","pow","selector","number","digits","multiplier","adjustedNum","truncatedNum","navigator","platform","indexOf","match"],"mappings":";;;;;;;;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAHA,IAAIA,IAAI,GAAG,IAAX;;AAMA;AACA;AACA;IACqBC,e;;;;;AAcjB;AACA,2BAAYC,UAAZ,EAAwBC,YAAxB,EAAsC;AAAA;;AAAA;;AAClC,8BAAMD,UAAN,EAAkBC,YAAlB;AACAH,IAAAA,IAAI,GAAGI,OAAO,CAAC,SAAD,CAAd;AACA,UAAKC,OAAL,GAAe,EAAf;AACA,UAAKC,OAAL,GAAe,KAAf,CAJkC,CAMlC;;AACA,UAAKC,eAAL,GAAuB,MAAKL,UAAL,CAAgBM,OAAhB,CAAwBD,eAAxB,GAAwC,MAAKL,UAAL,CAAgBM,OAAhB,CAAwBD,eAAhE,GAAgF,EAAvG,CAPkC,CASlC;;AACA,UAAKE,QAAL,GAAgB,CAAhB;AACA,UAAKC,QAAL,GAAgB,CAAhB;AAXkC;AAYrC;;;;SAzBD,eAAgB;AACZ,aAAO;AACHC,QAAAA,IAAI,EAAE,kBADH;AAEHC,QAAAA,OAAO,EAAE,iBAFN;AAGHC,QAAAA,GAAG,EAAE,mBAHF;AAIHC,QAAAA,GAAG,EAAE,mBAJF;AAKHC,QAAAA,GAAG,EAAE,oBALF;AAMHC,QAAAA,GAAG,EAAE,oBANF;AAOHC,QAAAA,aAAa,EAAE;AAPZ,OAAP;AASH;;;WAiBD,gBAAO;AAAA;;AACH,WAAKC,aAAL,GAAqBC,MAAM,CAACC,UAA5B;AACA,WAAKC,cAAL,GAAsBF,MAAM,CAACG,WAA7B;AAEA,WAAKC,KAAL,GAAa,IAAIvB,IAAI,CAACwB,SAAT,EAAb;AACA,WAAKC,MAAL,GAAc,IAAIzB,IAAI,CAACwB,SAAT,EAAd;AACA,WAAKE,MAAL,GAAc,IAAI1B,IAAI,CAACwB,SAAT,EAAd;AAEA,WAAKD,KAAL,CAAWI,QAAX,CAAoB,KAAKF,MAAzB,EAAiC,KAAKC,MAAtC;;AAEA,UAAIE,QAAQ,CAACC,UAAT,KAAwB,UAAxB,IAAsCD,QAAQ,CAACC,UAAT,KAAwB,QAA9D,IAA0ED,QAAQ,CAACC,UAAT,KAAwB,aAAtG,EAAqH;AACjH,aAAKC,WAAL;AACH,OAFD,MAEO;AACHF,QAAAA,QAAQ,CAACG,gBAAT,CAA0B,kBAA1B,EAA8C,YAAI;AAC9C,UAAA,MAAI,CAACD,WAAL;AACH,SAFD;AAGH;;AAED,aAAO,IAAIE,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAmB;AAClClC,QAAAA,IAAI,CAACmC,MAAL,CAAYC,GAAZ,CAAgBC,MAAM,CAACC,IAAP,CAAY,MAAI,CAACC,UAAjB,EAA6BC,GAA7B,CAAiC,UAACC,CAAD,EAAK;AAClD,iBAAM;AACFC,YAAAA,IAAI,EAAED,CADJ;AAEFE,YAAAA,GAAG,EAAE,MAAI,CAACpC,eAAL,GAAuB,MAAI,CAACgC,UAAL,CAAgBE,CAAhB;AAF1B,WAAN;AAIH,SALe,CAAhB,EAMCG,IAND,CAMM,YAAM;AACR,UAAA,MAAI,CAACtC,OAAL,GAAe,IAAf;;AACA,UAAA,MAAI,CAACuC,UAAL;;AAEA,cAAIC,kBAAMC,aAAN,EAAJ,EAA2B;AACvBnB,YAAAA,QAAQ,CAACoB,IAAT,CAAcC,SAAd,CAAwBb,GAAxB,CAA4B,OAA5B;AACH,WAFD,MAEO,IAAIc,WAAW,EAAf,EAAmB;AACtBtB,YAAAA,QAAQ,CAACoB,IAAT,CAAcC,SAAd,CAAwBb,GAAxB,CAA4B,KAA5B;AACH,WAFM,MAEA,IAAIe,SAAS,EAAb,EAAiB;AACpBvB,YAAAA,QAAQ,CAACoB,IAAT,CAAcC,SAAd,CAAwBb,GAAxB,CAA4B,IAA5B;AACH;;AAEDH,UAAAA,OAAO;;AAEP,UAAA,MAAI,CAAC/B,UAAL,CAAgBkD,IAAhB,CAAqB,gBAArB;AACH,SArBD;AAsBH,OAvBM,CAAP;AAwBH;;;WAED,uBAAa;AACT,WAAKC,QAAL,GAAgBrD,IAAI,CAACsD,kBAAL,CAAwB,KAAKpC,aAA7B,EAA4C,KAAKG,cAAjD,CAAhB;AACAO,MAAAA,QAAQ,CAACoB,IAAT,CAAcO,aAAd,CAA4B,gBAA5B,EAA8CC,WAA9C,CAA0D,KAAKH,QAAL,CAAcI,IAAxE;AACH;;;WAED,sBAAa;AAAA;;AACTtC,MAAAA,MAAM,CAACY,gBAAP,CAAwB,QAAxB,EAAkC,YAAI;AAAE,QAAA,MAAI,CAAC2B,eAAL;AAAyB,OAAjE;AAEA,WAAKC,SAAL,GAAiB;AAAElB,QAAAA,CAAC,EAAE,CAAL;AAAQmB,QAAAA,CAAC,EAAE;AAAX,OAAjB;AACA,WAAKC,MAAL,GAAc,IAAI7D,IAAI,CAACwB,SAAT,EAAd;AACA,WAAKqC,MAAL,CAAYlC,QAAZ,CAAqB,KAAKF,MAA1B,EAAkC,KAAKC,MAAvC,EALS,CAOT;;AACA,WAAKb,GAAL,GAAW,IAAIb,IAAI,CAAC8D,MAAL,CAAYC,YAAhB,CAA6B/D,IAAI,CAACmC,MAAL,CAAY6B,SAAZ,CAAsBnD,GAAtB,CAA0BoD,OAAvD,EACH,KAAK/C,aADF,EACiB,KAAKG,cADtB,CAAX;AAEA,WAAKP,GAAL,GAAW,IAAId,IAAI,CAAC8D,MAAL,CAAYC,YAAhB,CAA6B/D,IAAI,CAACmC,MAAL,CAAY6B,SAAZ,CAAsBlD,GAAtB,CAA0BmD,OAAvD,EACP,KAAK/C,aADE,EACa,KAAKG,cADlB,CAAX;AAEA,WAAKN,GAAL,GAAW,IAAIf,IAAI,CAAC8D,MAAL,CAAYC,YAAhB,CAA6B/D,IAAI,CAACmC,MAAL,CAAY6B,SAAZ,CAAsBjD,GAAtB,CAA0BkD,OAAvD,EACP,KAAK/C,aADE,EACa,KAAKG,cADlB,CAAX;AAEA,WAAKL,GAAL,GAAW,IAAIhB,IAAI,CAAC8D,MAAL,CAAYC,YAAhB,CAA6B/D,IAAI,CAACmC,MAAL,CAAY6B,SAAZ,CAAsBhD,GAAtB,CAA0BiD,OAAvD,EACP,KAAK/C,aADE,EACa,KAAKG,cADlB,CAAX;AAGA,WAAKN,GAAL,CAASmD,SAAT,GAAqBlE,IAAI,CAACmE,WAAL,CAAiBC,GAAtC;AACA,WAAKpD,GAAL,CAASkD,SAAT,GAAqBlE,IAAI,CAACmE,WAAL,CAAiBC,GAAtC;AACA,WAAKpD,GAAL,CAASqD,KAAT,GAAiB,GAAjB;AAEA,WAAK9C,KAAL,CAAWI,QAAX,CAAoB,KAAKd,GAAzB,EAA8B,KAAKC,GAAnC,EAAwC,KAAKC,GAA7C,EAAkD,KAAKC,GAAvD;AACA,WAAKO,KAAL,CAAWI,QAAX,CAAoB,KAAKkC,MAAzB,EAtBS,CAwBT;AACA;AAEA;AACA;AACA;AACA;AACA;;AAEA,WAAKS,WAAL,GAAmBC,IAAI,CAACC,GAAL,EAAnB,CAjCS,CAkCT;;AACA,UAAI,qBAAqB1B,kBAAM2B,UAAN,EAAzB,EAA6C;AACzC,YAAIC,QAAQ,GAAG,IAAI1E,IAAI,CAAC2E,QAAT,EAAf;AACAD,QAAAA,QAAQ,CAACE,SAAT,CAAmB,QAAnB;AACAF,QAAAA,QAAQ,CAACL,KAAT,GAAiB,GAAjB;AACAK,QAAAA,QAAQ,CAACG,QAAT,CAAkB,CAAlB,EAAqB,CAArB,EAAwB,KAAK3E,UAAL,CAAgB4E,aAAhB,CAA8BC,KAAtD,EAA6D,KAAK7E,UAAL,CAAgB4E,aAAhB,CAA8BE,MAA3F;AACA,aAAKnB,MAAL,CAAYlC,QAAZ,CAAqB+C,QAArB;AACH;AAEJ;;;WAED,2BAAkB;AACd,WAAKxD,aAAL,GAAqBC,MAAM,CAACC,UAA5B;AACA,WAAKC,cAAL,GAAsBF,MAAM,CAACG,WAA7B;AAEA,WAAKT,GAAL,CAASkE,KAAT,GAAiB,KAAK7D,aAAtB;AACA,WAAKL,GAAL,CAASmE,MAAT,GAAkB,KAAK3D,cAAvB;AACA,WAAKP,GAAL,CAASiE,KAAT,GAAiB,KAAK7D,aAAtB;AACA,WAAKJ,GAAL,CAASkE,MAAT,GAAkB,KAAK3D,cAAvB;AACA,WAAKN,GAAL,CAASgE,KAAT,GAAiB,KAAK7D,aAAtB;AACA,WAAKH,GAAL,CAASiE,MAAT,GAAkB,KAAK3D,cAAvB;AACA,WAAKL,GAAL,CAAS+D,KAAT,GAAiB,KAAK7D,aAAtB;AACA,WAAKF,GAAL,CAASgE,MAAT,GAAkB,KAAK3D,cAAvB;AAEA,WAAKgC,QAAL,CAAc4B,MAAd,CAAqB,KAAK/D,aAA1B,EAAyC,KAAKG,cAA9C;AACH;;;WAED,cAAK6D,CAAL,EAAQC,EAAR,EAAY;AACR,gFAAWD,CAAX,EAAcC,EAAd;;AAEA,UAAIX,GAAG,GAAGD,IAAI,CAACC,GAAL,EAAV;AAEA,UAAI,CAAC,KAAKlE,OAAV,EAAmB,OALX,CAKmB;;AAC3B,UAAI8E,UAAU,GAAG,KAAKlF,UAAL,CAAgB4E,aAAhB,CAA8BC,KAA/C;AACA,UAAIM,WAAW,GAAG,KAAKnF,UAAL,CAAgB4E,aAAhB,CAA8BE,MAAhD;AAEA,UAAIM,sBAAsB,GAAG,KAAKzB,MAAL,CAAYpB,CAAZ,GAAgB,KAAKvB,aAAL,GAAqBkE,UAAlE;AACA,UAAIG,qBAAqB,GAAG,KAAK1B,MAAL,CAAYpB,CAAZ,GAAgB,CAA5C;AACA,UAAI+C,oBAAoB,GAAG,KAAK3B,MAAL,CAAYD,CAAZ,GAAgB,CAA3C;AACA,UAAI6B,uBAAuB,GAAG,KAAK5B,MAAL,CAAYD,CAAZ,GAAgB,KAAKvC,cAAL,GAAsBgE,WAApE;;AAEA,sCAAkBhD,MAAM,CAACC,IAAP,CAAY,KAAKjC,OAAjB,CAAlB,kCAA6C;AAAxC,YAAIqF,KAAK,mBAAT;AACD,YAAIC,OAAO,GAAG,KAAKzF,UAAL,CAAgB0F,KAAhB,CAAsBC,OAAtB,CAA8BH,KAA9B,CAAd;AACA,YAAII,MAAM,GAAG,KAAKzF,OAAL,CAAaqF,KAAb,CAAb;;AAEA,YAAIC,OAAJ,EAAa;AAET;AACA,cAAIG,MAAM,CAACC,KAAP,IAAgBD,MAAM,CAACC,KAAP,CAAaC,aAAjC,EAAgD;AAC5CF,YAAAA,MAAM,CAACC,KAAP,CAAaC,aAAb,CAA2B5C,IAA3B,GAAkC,CAAC,CAACuC,OAAO,CAACM,UAA5C;AACH;;AAED,cAAIN,OAAO,YAAYO,gBAAnB,IAA2BJ,MAAM,IAAI,KAAKK,UAA9C,EAA0D;AACtD,iBAAKC,wBAAL,CAA8BT,OAA9B;AACH;;AAEDG,UAAAA,MAAM,CAACrD,CAAP,GAAWkD,OAAO,CAACU,QAAR,CAAiB5D,CAA5B;AACAqD,UAAAA,MAAM,CAAClC,CAAP,GAAW+B,OAAO,CAACU,QAAR,CAAiBzC,CAA5B;;AAEA,cAAI+B,OAAO,YAAYO,gBAAvB,EAA4B;AACxBJ,YAAAA,MAAM,CAACC,KAAP,CAAaO,mBAAb,CAAiCC,QAAjC,GAA4C,KAAKrG,UAAL,CAAgB0F,KAAhB,CAAsBC,OAAtB,CAA8BH,KAA9B,EAAqCc,KAArC,GAA6CC,IAAI,CAACC,EAAlD,GAAqD,GAAjG;AACH,WAFD,MAEM;AACFZ,YAAAA,MAAM,CAACS,QAAP,GAAkB,KAAKrG,UAAL,CAAgB0F,KAAhB,CAAsBC,OAAtB,CAA8BH,KAA9B,EAAqCc,KAArC,GAA6CC,IAAI,CAACC,EAAlD,GAAqD,GAAvE;AACH,WAlBQ,CAoBT;;;AACA,cAAIZ,MAAM,IAAI,KAAKK,UAAf,IAA6BZ,qBAA7B,IAAsDI,OAAO,CAACU,QAAR,CAAiB5D,CAAjB,GAAqB,KAAKvB,aAAL,GAAqB,KAAK2C,MAAL,CAAYpB,CAAhH,EAAmH;AAC/GqD,YAAAA,MAAM,CAACrD,CAAP,GAAWkD,OAAO,CAACU,QAAR,CAAiB5D,CAAjB,GAAqB2C,UAAhC;AACH;;AACD,cAAIU,MAAM,IAAI,KAAKK,UAAf,IAA6Bb,sBAA7B,IAAuDK,OAAO,CAACU,QAAR,CAAiB5D,CAAjB,GAAqB,CAAC,KAAKoB,MAAL,CAAYpB,CAA7F,EAAgG;AAC5FqD,YAAAA,MAAM,CAACrD,CAAP,GAAWkD,OAAO,CAACU,QAAR,CAAiB5D,CAAjB,GAAqB2C,UAAhC;AACH;;AACD,cAAIU,MAAM,IAAI,KAAKK,UAAf,IAA6BX,oBAA7B,IAAqDG,OAAO,CAACU,QAAR,CAAiBzC,CAAjB,GAAqB,KAAKvC,cAAL,GAAsB,KAAKwC,MAAL,CAAYD,CAAhH,EAAmH;AAC/GkC,YAAAA,MAAM,CAAClC,CAAP,GAAW+B,OAAO,CAACU,QAAR,CAAiBzC,CAAjB,GAAqByB,WAAhC;AACH;;AACD,cAAIS,MAAM,IAAI,KAAKK,UAAf,IAA6BV,uBAA7B,IAAwDE,OAAO,CAACU,QAAR,CAAiBzC,CAAjB,GAAqB,CAAC,KAAKC,MAAL,CAAYD,CAA9F,EAAiG;AAC7FkC,YAAAA,MAAM,CAAClC,CAAP,GAAW+B,OAAO,CAACU,QAAR,CAAiBzC,CAAjB,GAAqByB,WAAhC;AACH;AACJ;;AAED,YAAIS,MAAJ,EAAY;AACR;AACA,cAAIA,MAAM,CAACC,KAAP,IAAgBD,MAAM,CAACC,KAAP,CAAaY,UAAjC,EAA6C;AACzCb,YAAAA,MAAM,CAACC,KAAP,CAAaY,UAAb,CAAwBnC,GAAG,GAAG,KAAKF,WAAnC;AACH;AACJ,SA5CwC,CA8CzC;;AACH;;AAED,UAAIsC,YAAJ;;AACA,UAAI,KAAKT,UAAT,EAAqB;AACjBS,QAAAA,YAAY,GAAG,KAAKT,UAApB,CADiB,CAEjB;AACH,OAHD,MAGO,IAAI,CAAC,KAAKU,WAAN,IAAqB,CAACD,YAA1B,EAAwC;AAE3C;AACAA,QAAAA,YAAY,GAAGE,WAAW,CAAC,KAAK5G,UAAL,CAAgB0F,KAAhB,CAAsBC,OAAvB,CAA1B;AACA,aAAKkB,UAAL,GAAkB,IAAlB;AACH;;AAED,UAAIH,YAAJ,EAAkB;AACd;AACA;AAEA;AACA,YAAI,KAAKG,UAAT,EAAqB;AACjB,cAAIC,eAAe,GAAGJ,YAAY,CAACnE,CAAb,GAAiB,KAAKkB,SAAL,CAAelB,CAAtD;AACA,cAAIwE,eAAe,GAAGL,YAAY,CAAChD,CAAb,GAAiB,KAAKD,SAAL,CAAeC,CAAtD;AACA,cAAIsD,iBAAJ;AACA,cAAIC,iBAAJ;;AAEA,cAAIH,eAAe,GAAG5B,UAAU,GAAG,CAAnC,EAAsC;AAClC,iBAAK3E,QAAL;AACAyG,YAAAA,iBAAiB,GAAG,KAAKvD,SAAL,CAAelB,CAAf,GAAmB2C,UAAvC;AACH,WAHD,MAGO,IAAI4B,eAAe,GAAG,CAAC5B,UAAD,GAAc,CAApC,EAAuC;AAC1C,iBAAK3E,QAAL;AACAyG,YAAAA,iBAAiB,GAAG,KAAKvD,SAAL,CAAelB,CAAf,GAAmB2C,UAAvC;AACH,WAHM,MAGA;AACH8B,YAAAA,iBAAiB,GAAG,KAAKvD,SAAL,CAAelB,CAAf,GAAmBuE,eAAe,GAAG,IAAzD;AACH;;AAED,cAAIC,eAAe,GAAG5B,WAAW,GAAG,CAApC,EAAuC;AACnC8B,YAAAA,iBAAiB,GAAG,KAAKxD,SAAL,CAAeC,CAAf,GAAmByB,WAAvC;AACA,iBAAK3E,QAAL;AACH,WAHD,MAGO,IAAIuG,eAAe,GAAG,CAAC5B,WAAD,GAAe,CAArC,EAAwC;AAC3C,iBAAK3E,QAAL;AACAyG,YAAAA,iBAAiB,GAAG,KAAKxD,SAAL,CAAeC,CAAf,GAAmByB,WAAvC;AACH,WAHM,MAGA;AACH8B,YAAAA,iBAAiB,GAAG,KAAKxD,SAAL,CAAeC,CAAf,GAAmBqD,eAAe,GAAG,IAAzD;AACH;;AAED,eAAKG,YAAL,CAAkBF,iBAAlB,EAAqCC,iBAArC;AAEH,SA5BD,MA4BO;AACH,eAAKC,YAAL,CAAkBR,YAAY,CAACnE,CAA/B,EAAkCmE,YAAY,CAAChD,CAA/C;AACH;AACJ;;AAED,UAAIyD,SAAS,GAAG,KAAK5G,QAAL,GAAgB2E,UAAhB,GAA6B,KAAKvB,MAAL,CAAYpB,CAAzD;AACA,UAAI6E,SAAS,GAAG,KAAK5G,QAAL,GAAgB2E,WAAhB,GAA8B,KAAKxB,MAAL,CAAYD,CAA1D;AAEA,WAAK/C,GAAL,CAAS0G,YAAT,CAAsB9E,CAAtB,GAA0B4E,SAAS,GAAG,IAAtC;AACA,WAAKxG,GAAL,CAAS0G,YAAT,CAAsB3D,CAAtB,GAA0B0D,SAAS,GAAG,IAAtC;AAEA,WAAKxG,GAAL,CAASyG,YAAT,CAAsB9E,CAAtB,GAA0B4E,SAAS,GAAG,IAAtC;AACA,WAAKvG,GAAL,CAASyG,YAAT,CAAsB3D,CAAtB,GAA0B0D,SAAS,GAAG,IAAtC;AAEA,WAAKvG,GAAL,CAASwG,YAAT,CAAsB9E,CAAtB,GAA0B4E,SAAS,GAAG,GAAtC;AACA,WAAKtG,GAAL,CAASwG,YAAT,CAAsB3D,CAAtB,GAA0B0D,SAAS,GAAG,GAAtC;AAEA,WAAKtG,GAAL,CAASuG,YAAT,CAAsB9E,CAAtB,GAA0B4E,SAAS,GAAG,IAAtC;AACA,WAAKrG,GAAL,CAASuG,YAAT,CAAsB3D,CAAtB,GAA0B0D,SAAS,GAAG,IAAtC;AAEA,WAAKhD,WAAL,GAAmBE,GAAnB,CA/HQ,CAiIR;;AACA,WAAKnB,QAAL,CAAcmE,MAAd,CAAqB,KAAKjG,KAA1B;AACH;;;WAED,uBAAcuE,MAAd,EAAsB;AAClB,WAAKK,UAAL,GAAkBL,MAAlB;AACAA,MAAAA,MAAM,CAACC,KAAP,CAAa0B,UAAb,CAAwBC,IAAxB,GAA+B,QAA/B,CAFkB,CAEuB;;AACzC9F,MAAAA,QAAQ,CAACoB,IAAT,CAAcC,SAAd,CAAwB0E,MAAxB,CAA+B,UAA/B;;AACA,UAAI,CAAC/F,QAAQ,CAACoB,IAAT,CAAcC,SAAd,CAAwB2E,QAAxB,CAAiC,cAAjC,CAAL,EAAsD;AAClDhG,QAAAA,QAAQ,CAACoB,IAAT,CAAcC,SAAd,CAAwBb,GAAxB,CAA4B,UAA5B;AACH;;AACDR,MAAAA,QAAQ,CAACoB,IAAT,CAAcC,SAAd,CAAwB0E,MAAxB,CAA+B,UAA/B;AACA/F,MAAAA,QAAQ,CAACoB,IAAT,CAAcC,SAAd,CAAwBb,GAAxB,CAA4B,YAA5B;AACAR,MAAAA,QAAQ,CAAC2B,aAAT,CAAuB,WAAvB,EAAoCsE,QAApC,GAA+C,IAA/C;AACAjG,MAAAA,QAAQ,CAAC2B,aAAT,CAAuB,WAAvB,EAAoCsE,QAApC,GAA+C,IAA/C;AACAjG,MAAAA,QAAQ,CAAC2B,aAAT,CAAuB,WAAvB,EAAoCuE,KAApC,CAA0CC,OAA1C,GAAoD,CAApD;AAEA,WAAKlB,WAAL,GAAmB,IAAnB,CAbkB,CAaO;AAEzB;;AACAmB,MAAAA,UAAU,CAAC,YAAM;AACbpG,QAAAA,QAAQ,CAACoB,IAAT,CAAcC,SAAd,CAAwB0E,MAAxB,CAA+B,UAA/B;AACH,OAFS,EAEP,KAFO,CAAV;AAGH;AAED;AACJ;AACA;AACA;AACA;;;;WACI,sBAAaM,OAAb,EAAsBC,OAAtB,EAA+B;AAC3B,UAAIC,KAAK,CAACF,OAAD,CAAL,IAAkBE,KAAK,CAACD,OAAD,CAA3B,EAAsC;;AACtC,UAAI,CAAC,KAAKE,kBAAV,EAA6B;AACzB,aAAKA,kBAAL,GAA0B,EAA1B;AACH;;AAED,WAAKA,kBAAL,CAAwB3F,CAAxB,GAA4B,KAAKoB,MAAL,CAAYpB,CAAxC;AACA,WAAK2F,kBAAL,CAAwBxE,CAAxB,GAA4B,KAAKC,MAAL,CAAYD,CAAxC;AAEA,WAAKC,MAAL,CAAYpB,CAAZ,GAAgB,KAAKvB,aAAL,GAAqB,CAArB,GAAyB+G,OAAzC;AACA,WAAKpE,MAAL,CAAYD,CAAZ,GAAgB,KAAKvC,cAAL,GAAsB,CAAtB,GAA0B6G,OAA1C;AACA,WAAKvE,SAAL,CAAelB,CAAf,GAAmBwF,OAAnB;AACA,WAAKtE,SAAL,CAAeC,CAAf,GAAmBsE,OAAnB;AACH;;;WAED,+BAAsBvC,OAAtB,EAA+B;AAC3B,UAAI0C,SAAS,GAAGzG,QAAQ,CAAC2B,aAAT,CAAuB,8BAAvB,CAAhB;AACA,UAAI+E,WAAW,GAAG1G,QAAQ,CAAC2G,aAAT,CAAuB,KAAvB,CAAlB;AACAD,MAAAA,WAAW,CAACE,YAAZ,CAAyB,IAAzB,EAA+B,uBAAuB7C,OAAO,CAAC8C,EAA9D;AACAH,MAAAA,WAAW,CAACrF,SAAZ,CAAsBb,GAAtB,CAA0B,oBAA1B;AACAiG,MAAAA,SAAS,CAAC7E,WAAV,CAAsB8E,WAAtB;AACH;;;WAED,kCAAyB3C,OAAzB,EAAiC;AAC7B;AACA,UAAI,CAAC,KAAKQ,UAAV,EAAsB;AAEtB,UAAImC,WAAW,GAAG1G,QAAQ,CAAC2B,aAAT,CAAuB,wBAAwBoC,OAAO,CAAC8C,EAAvD,CAAlB;;AACA,UAAI,CAACH,WAAL,EAAkB;AACdI,QAAAA,OAAO,CAACC,KAAR,wCAA8ChD,OAAO,CAAC8C,EAAtD;AACA;AACH;;AACD,UAAIG,aAAa,GAAG,KAAK1I,UAAL,CAAgB0F,KAAhB,CAAsBC,OAAtB,CAA8B,KAAKM,UAAL,CAAgBsC,EAA9C,CAApB;AACA,UAAII,KAAK,GAAG,CAAClD,OAAO,CAACU,QAAR,CAAiBzC,CAAjB,GAAqBgF,aAAa,CAACvC,QAAd,CAAuBzC,CAA7C,KAAmD+B,OAAO,CAACU,QAAR,CAAiB5D,CAAjB,GAAqBmG,aAAa,CAACvC,QAAd,CAAuB5D,CAA/F,CAAZ;AACA,UAAIqG,CAAC,GAAG,KAAKzH,cAAL,GAAqB,CAA7B;AAEA,UAAI0H,OAAO,GAAG,EAAd;AACA,UAAIC,YAAY,GAAG;AAAEvG,QAAAA,CAAC,EAAE,CAAL;AAAQmB,QAAAA,CAAC,EAAE;AAAX,OAAnB;;AAEA,UAAI+B,OAAO,CAACU,QAAR,CAAiBzC,CAAjB,GAAqBgF,aAAa,CAACvC,QAAd,CAAuBzC,CAAvB,GAA2B,KAAKvC,cAAL,GAAoB,CAAxE,EAA2E;AACvE2H,QAAAA,YAAY,CAACvG,CAAb,GAAiB,KAAKvB,aAAL,GAAmB,CAAnB,GAAuB,CAAC6H,OAAO,GAAGD,CAAX,IAAcD,KAAtD;AACAG,QAAAA,YAAY,CAACpF,CAAb,GAAiBmF,OAAjB;AACH,OAHD,MAGO,IAAIpD,OAAO,CAACU,QAAR,CAAiBzC,CAAjB,GAAqBgF,aAAa,CAACvC,QAAd,CAAuBzC,CAAvB,GAA2B,KAAKvC,cAAL,GAAoB,CAAxE,EAA2E;AAC9E2H,QAAAA,YAAY,CAACvG,CAAb,GAAiB,KAAKvB,aAAL,GAAmB,CAAnB,GAAuB,CAAC,KAAKG,cAAL,GAAsB0H,OAAtB,GAAgCD,CAAjC,IAAoCD,KAA5E;AACAG,QAAAA,YAAY,CAACpF,CAAb,GAAiB,KAAKvC,cAAL,GAAsB0H,OAAvC;AACH;;AAED,UAAIpD,OAAO,CAACU,QAAR,CAAiB5D,CAAjB,GAAqBmG,aAAa,CAACvC,QAAd,CAAuB5D,CAAvB,GAA2B,KAAKvB,aAAL,GAAmB,CAAvE,EAA0E;AACtE8H,QAAAA,YAAY,CAACvG,CAAb,GAAiBsG,OAAjB;AACAC,QAAAA,YAAY,CAACpF,CAAb,GAAiBiF,KAAK,IAAI,CAAC,KAAK3H,aAAN,GAAoB,CAApB,GAAwB6H,OAA5B,CAAL,GAA4CD,CAA7D;AACH,OAHD,MAGO,IAAInD,OAAO,CAACU,QAAR,CAAiB5D,CAAjB,GAAqBmG,aAAa,CAACvC,QAAd,CAAuB5D,CAAvB,GAA2B,KAAKvB,aAAL,GAAmB,CAAvE,EAA0E;AAC7E8H,QAAAA,YAAY,CAACvG,CAAb,GAAiB,KAAKvB,aAAL,GAAqB6H,OAAtC;AACAC,QAAAA,YAAY,CAACpF,CAAb,GAAiBiF,KAAK,IAAI,KAAK3H,aAAL,GAAmB,CAAnB,GAAuB6H,OAA3B,CAAL,GAA2CD,CAA5D;AACH;;AAED,UAAIE,YAAY,CAACvG,CAAb,IAAkB,CAAlB,IAAuBuG,YAAY,CAACpF,CAAb,IAAkB,CAA7C,EAA+C;AAC3C0E,QAAAA,WAAW,CAACR,KAAZ,CAAkBC,OAAlB,GAA4B,CAA5B;AACH,OAFD,MAEO;AACHO,QAAAA,WAAW,CAACR,KAAZ,CAAkBC,OAAlB,GAA4B,CAA5B;AACA,YAAIxB,QAAQ,GAAGE,IAAI,CAACwC,KAAL,CAAWtD,OAAO,CAACU,QAAR,CAAiBzC,CAAjB,GAAqBgF,aAAa,CAACvC,QAAd,CAAuBzC,CAAvD,EAA0D+B,OAAO,CAACU,QAAR,CAAiB5D,CAAjB,GAAqBmG,aAAa,CAACvC,QAAd,CAAuB5D,CAAtG,CAAf;AACA8D,QAAAA,QAAQ,GAAGA,QAAQ,GAAG,GAAX,GAAeE,IAAI,CAACC,EAA/B,CAHG,CAGgC;;AACnC4B,QAAAA,WAAW,CAACR,KAAZ,CAAkBoB,SAAlB,wBAA4CF,YAAY,CAACvG,CAAzD,4BAA4EuG,YAAY,CAACpF,CAAzF,wBAAwG2C,QAAxG;AACH;AACJ;;;WAED,kCAAyBZ,OAAzB,EAAkC;AAC9B,UAAI2C,WAAW,GAAG1G,QAAQ,CAAC2B,aAAT,CAAuB,wBAAsBoC,OAAO,CAAC8C,EAArD,CAAlB;AACA,UAAIH,WAAW,IAAIA,WAAW,CAACa,UAA/B,EACIb,WAAW,CAACa,UAAZ,CAAuBC,WAAvB,CAAmCd,WAAnC;AACP;;;WAED,mBAAUe,IAAV,EAAe;AACX,UAAIA,IAAI,CAACC,GAAT,EAAa;AAAEC,QAAAA,EAAE,CAAC,cAAD,CAAF,CAAmBC,SAAnB,GAA+BH,IAAI,CAACC,GAApC;AAAyC;;AACxD,UAAID,IAAI,CAACI,UAAT,EAAoB;AAAEF,QAAAA,EAAE,CAAC,qBAAD,CAAF,CAA0BC,SAA1B,GAAsCE,gBAAgB,CAACL,IAAI,CAACI,UAAN,EAAkB,CAAlB,CAAtD;AAA4E;AACrG;;;WAED,qBAAYJ,IAAZ,EAAiB;AACb,UAAIM,cAAc,GAAGJ,EAAE,CAAC,QAAD,CAAvB;AACA,UAAIK,UAAU,GAAG,EAAjB,CAFa,CAIb;;AACA,UAAIC,QAAQ,GAAGF,cAAc,CAACG,gBAAf,CAAgC,OAAhC,CAAf;;AACA,WAAK,IAAIrH,CAAC,GAAC,CAAX,EAAcA,CAAC,GAAGoH,QAAQ,CAACE,MAA3B,EAAmCtH,CAAC,EAApC,EAAuC;AACnC,YAAI4G,IAAI,CAACQ,QAAQ,CAACpH,CAAD,CAAR,CAAYuH,OAAZ,CAAoBtE,KAArB,CAAJ,IAAmC,IAAvC,EAA4C;AACxCmE,UAAAA,QAAQ,CAACpH,CAAD,CAAR,CAAY0G,UAAZ,CAAuBC,WAAvB,CAAmCS,QAAQ,CAACpH,CAAD,CAA3C;AACH;AACJ;;AAED,wCAAeJ,MAAM,CAACC,IAAP,CAAY+G,IAAZ,CAAf,qCAAiC;AAA5B,YAAIZ,EAAE,qBAAN;AACD,YAAIwB,OAAO,GAAGN,cAAc,CAACpG,aAAf,yBAA8CkF,EAA9C,QAAd,CAD6B,CAE7B;;AACA,YAAIwB,OAAO,IAAI,IAAf,EAAoB;AAChBA,UAAAA,OAAO,GAAGrI,QAAQ,CAAC2G,aAAT,CAAuB,KAAvB,CAAV;AACA0B,UAAAA,OAAO,CAAChH,SAAR,CAAkBb,GAAlB,CAAsB,MAAtB;AACA,cAAI,KAAK+D,UAAL,IAAmB,KAAKA,UAAL,CAAgBsC,EAAhB,IAAsByB,QAAQ,CAACzB,EAAD,CAArD,EAA2DwB,OAAO,CAAChH,SAAR,CAAkBb,GAAlB,CAAsB,KAAtB;AAC3D6H,UAAAA,OAAO,CAACD,OAAR,CAAgBtE,KAAhB,GAAwB+C,EAAxB;AACAkB,UAAAA,cAAc,CAACnG,WAAf,CAA2ByG,OAA3B;AACH,SAT4B,CAW7B;;;AACA,YAAI,KAAK5J,OAAL,CAAa6J,QAAQ,CAACzB,EAAD,CAArB,CAAJ,EACI,KAAKpI,OAAL,CAAa6J,QAAQ,CAACzB,EAAD,CAArB,EAA2B1C,KAA3B,CAAiCoE,UAAjC,CAA4Cd,IAAI,CAACZ,EAAD,CAAJ,CAAS/F,IAArD;AAEJuH,QAAAA,OAAO,CAACT,SAAR,aAAuBH,IAAI,CAACZ,EAAD,CAAJ,CAAS/F,IAAhC,eAAyC2G,IAAI,CAACZ,EAAD,CAAJ,CAAS2B,KAAlD;AAEAR,QAAAA,UAAU,CAACS,IAAX,CAAgB;AACZC,UAAAA,EAAE,EAAEL,OADQ;AAEZZ,UAAAA,IAAI,EAAEA,IAAI,CAACZ,EAAD;AAFE,SAAhB;AAIH;;AAEDmB,MAAAA,UAAU,CAACW,IAAX,CAAgB,UAACC,CAAD,EAAI1B,CAAJ,EAAU;AAAC,eAAO0B,CAAC,CAACnB,IAAF,CAAOe,KAAP,GAAetB,CAAC,CAACO,IAAF,CAAOe,KAA7B;AAAoC,OAA/D;;AAEA,WAAK,IAAI3H,EAAC,GAAC,CAAX,EAAcA,EAAC,GAAGmH,UAAU,CAACG,MAA7B,EAAqCtH,EAAC,EAAtC,EAAyC;AACrCmH,QAAAA,UAAU,CAACnH,EAAD,CAAV,CAAc6H,EAAd,CAAiBxC,KAAjB,CAAuBoB,SAAvB,wBAAiDzG,EAAjD;AACH;AAEJ;;;WAED,qBAAYgI,CAAZ,EAAc;AACV,UAAI,KAAKtE,UAAT,EAAqB;AACjB,YAAIsE,CAAC,CAACC,OAAF,KAAc,IAAlB,EAAwB;AACpB,eAAKvE,UAAL,CAAgBJ,KAAhB,CAAsBC,aAAtB,CAAoC5C,IAApC,GAA2CqH,CAAC,CAACE,MAA7C;AACH;AACJ;AACJ;;;WAED,4BAAkB;AACd,UAAIC,cAAc,GAAIhJ,QAAQ,CAACiJ,iBAAT,IAA8BjJ,QAAQ,CAACiJ,iBAAT,KAA+B,IAA9D,IAA0E;AAC1FjJ,MAAAA,QAAQ,CAACkJ,aAAT,IAA0BlJ,QAAQ,CAACmJ,kBADxC,CADc,CAId;;AACA,UAAIC,YAAY,EAAhB,EAAoB;AAEpB,UAAIC,MAAM,GAAGrJ,QAAQ,CAACsJ,eAAtB;;AACA,UAAI,CAACN,cAAL,EAAqB;AAEjB,YAAIK,MAAM,CAACE,iBAAX,EAA8B;AAC1BF,UAAAA,MAAM,CAACE,iBAAP;AACH,SAFD,MAEO,IAAIF,MAAM,CAACG,oBAAX,EAAiC;AACpCH,UAAAA,MAAM,CAACG,oBAAP;AACH,SAFM,MAEA,IAAIH,MAAM,CAACI,uBAAX,EAAoC,CACvC;AACA;AACA;AACH;AACJ;AACJ;AAED;AACJ;AACA;AACA;;;;WACI,4BAAmBC,GAAnB,EAAuB;AACnB;AACA,aAAO;AACH7I,QAAAA,CAAC,EAAE6I,GAAG,CAACjF,QAAJ,CAAa5D,CAAb,GAAiB,KAAKoB,MAAL,CAAYpB,CAD7B;AAEHmB,QAAAA,CAAC,EAAE0H,GAAG,CAACjF,QAAJ,CAAazC,CAAb,GAAiB,KAAKC,MAAL,CAAYD;AAF7B,OAAP;AAIH;;;;EAzcwC2H,iB;;;;AA6c7C,SAASzE,WAAT,CAAqBjB,OAArB,EAA8B;AAC1B,MAAI2F,WAAW,GAAG,GAAlB,CAD0B,CACH;;AACvB,MAAIC,SAAS,GAAG,CAAhB;AACA,MAAIC,QAAQ,GAAG;AAAEjJ,IAAAA,CAAC,EAAE,CAAL;AAAQmB,IAAAA,CAAC,EAAE;AAAX,GAAf;AACA,MAAI+H,YAAY,GAAG,IAAnB;;AAEA,oCAAetJ,MAAM,CAACC,IAAP,CAAYuD,OAAZ,CAAf,qCAAoC;AAA/B,QAAI4C,EAAE,qBAAN;AACD,QAAI6C,GAAG,GAAGzF,OAAO,CAAC4C,EAAD,CAAjB;;AACA,QAAI6C,GAAG,YAAYpF,gBAAnB,EAAyB;AACrB,UAAIyF,YAAY,IAAI,IAApB,EACIA,YAAY,GAAGL,GAAf;AAEJ,UAAIM,WAAW,GAAGnF,IAAI,CAACoF,IAAL,CAAWpF,IAAI,CAACqF,GAAL,CAAUH,YAAY,CAACtF,QAAb,CAAsB5D,CAAtB,GAAwB6I,GAAG,CAACjF,QAAJ,CAAazC,CAA/C,EAAmD,CAAnD,IAAwD6C,IAAI,CAACqF,GAAL,CAAUH,YAAY,CAACtF,QAAb,CAAsBzC,CAAtB,GAAwB0H,GAAG,CAACjF,QAAJ,CAAazC,CAA/C,EAAmD,CAAnD,CAAnE,CAAlB;;AACA,UAAI+H,YAAY,IAAIL,GAAhB,IAAuBM,WAAW,GAAGJ,WAAzC,EAAsD;AAClDE,QAAAA,QAAQ,CAACjJ,CAAT,IAAc6I,GAAG,CAACjF,QAAJ,CAAa5D,CAA3B;AACAiJ,QAAAA,QAAQ,CAAC9H,CAAT,IAAc0H,GAAG,CAACjF,QAAJ,CAAazC,CAA3B;AACA6H,QAAAA,SAAS;AACZ;AACJ;AACJ;;AAEDC,EAAAA,QAAQ,CAACjJ,CAAT,IAAcgJ,SAAd;AACAC,EAAAA,QAAQ,CAAC9H,CAAT,IAAc6H,SAAd;AAGA,SAAOC,QAAP;AACH,C,CAED;;;AACA,SAASnC,EAAT,CAAYwC,QAAZ,EAAsB;AAAE,SAAOnK,QAAQ,CAAC2B,aAAT,CAAuBwI,QAAvB,CAAP;AAAyC;;AAEjE,SAASrC,gBAAT,CAA0BsC,MAA1B,EAAkCC,MAAlC,EAA0C;AACtC,MAAIC,UAAU,GAAGzF,IAAI,CAACqF,GAAL,CAAS,EAAT,EAAaG,MAAb,CAAjB;AACA,MAAIE,WAAW,GAAGH,MAAM,GAAGE,UAA3B;AACA,MAAIE,YAAY,GAAG3F,IAAI,CAAC0F,WAAW,GAAG,CAAd,GAAkB,MAAlB,GAA2B,OAA5B,CAAJ,CAAyCA,WAAzC,CAAnB;AAEA,SAAOC,YAAY,GAAGF,UAAtB;AACH;;AAAA;;AAED,SAAShJ,WAAT,GAAuB;AACnB,SAAOmJ,SAAS,CAACC,QAAV,CAAmBC,OAAnB,CAA2B,KAA3B,IAAoC,CAAC,CAA5C;AACH;;AAED,SAASpJ,SAAT,GAAqB;AACjB,SAAOkJ,SAAS,CAACC,QAAV,CAAmBC,OAAnB,CAA2B,KAA3B,IAAoC,CAAC,CAA5C;AACH;;AAED,SAASvB,YAAT,GAAwB;AACpB,SAAOqB,SAAS,CAACC,QAAV,CAAmBE,KAAnB,CAAyB,eAAzB,MAA8C,IAArD;AACH","sourcesContent":["let PIXI = null;\r\nimport { Renderer } from 'lance-gg';\r\nimport Utils from './../common/Utils';\r\nimport Ship from '../common/Ship';\r\n\r\n\r\n/**\r\n * Renderer for the Spaaace client - based on Pixi.js\r\n */\r\nexport default class SpaaaceRenderer extends Renderer {\r\n\r\n    get ASSETPATHS(){\r\n        return {\r\n            ship: 'assets/ship1.png',\r\n            missile: 'assets/shot.png',\r\n            bg1: 'assets/space3.png',\r\n            bg2: 'assets/space2.png',\r\n            bg3: 'assets/clouds2.png',\r\n            bg4: 'assets/clouds1.png',\r\n            smokeParticle: 'assets/smokeparticle.png'\r\n        };\r\n    }\r\n\r\n    // TODO: document\r\n    constructor(gameEngine, clientEngine) {\r\n        super(gameEngine, clientEngine);\r\n        PIXI = require('pixi.js');\r\n        this.sprites = {};\r\n        this.isReady = false;\r\n\r\n        // asset prefix\r\n        this.assetPathPrefix = this.gameEngine.options.assetPathPrefix?this.gameEngine.options.assetPathPrefix:'';\r\n\r\n        // these define how many gameWorlds the player ship has \"scrolled\" through\r\n        this.bgPhaseX = 0;\r\n        this.bgPhaseY = 0;\r\n    }\r\n\r\n    init() {\r\n        this.viewportWidth = window.innerWidth;\r\n        this.viewportHeight = window.innerHeight;\r\n\r\n        this.stage = new PIXI.Container();\r\n        this.layer1 = new PIXI.Container();\r\n        this.layer2 = new PIXI.Container();\r\n\r\n        this.stage.addChild(this.layer1, this.layer2);\r\n\r\n        if (document.readyState === 'complete' || document.readyState === 'loaded' || document.readyState === 'interactive') {\r\n            this.onDOMLoaded();\r\n        } else {\r\n            document.addEventListener('DOMContentLoaded', ()=>{\r\n                this.onDOMLoaded();\r\n            });\r\n        }\r\n\r\n        return new Promise((resolve, reject)=>{\r\n            PIXI.loader.add(Object.keys(this.ASSETPATHS).map((x)=>{\r\n                return{\r\n                    name: x,\r\n                    url: this.assetPathPrefix + this.ASSETPATHS[x]\r\n                };\r\n            }))\r\n            .load(() => {\r\n                this.isReady = true;\r\n                this.setupStage();\r\n\r\n                if (Utils.isTouchDevice()) {\r\n                    document.body.classList.add('touch');\r\n                } else if (isMacintosh()) {\r\n                    document.body.classList.add('mac');\r\n                } else if (isWindows()) {\r\n                    document.body.classList.add('pc');\r\n                }\r\n\r\n                resolve();\r\n\r\n                this.gameEngine.emit('renderer.ready');\r\n            });\r\n        });\r\n    }\r\n\r\n    onDOMLoaded(){\r\n        this.renderer = PIXI.autoDetectRenderer(this.viewportWidth, this.viewportHeight);\r\n        document.body.querySelector('.pixiContainer').appendChild(this.renderer.view);\r\n    }\r\n\r\n    setupStage() {\r\n        window.addEventListener('resize', ()=>{ this.setRendererSize(); });\r\n\r\n        this.lookingAt = { x: 0, y: 0 };\r\n        this.camera = new PIXI.Container();\r\n        this.camera.addChild(this.layer1, this.layer2);\r\n\r\n        // parallax background\r\n        this.bg1 = new PIXI.extras.TilingSprite(PIXI.loader.resources.bg1.texture,\r\n                this.viewportWidth, this.viewportHeight);\r\n        this.bg2 = new PIXI.extras.TilingSprite(PIXI.loader.resources.bg2.texture,\r\n            this.viewportWidth, this.viewportHeight);\r\n        this.bg3 = new PIXI.extras.TilingSprite(PIXI.loader.resources.bg3.texture,\r\n            this.viewportWidth, this.viewportHeight);\r\n        this.bg4 = new PIXI.extras.TilingSprite(PIXI.loader.resources.bg4.texture,\r\n            this.viewportWidth, this.viewportHeight);\r\n\r\n        this.bg3.blendMode = PIXI.BLEND_MODES.ADD;\r\n        this.bg4.blendMode = PIXI.BLEND_MODES.ADD;\r\n        this.bg4.alpha = 0.6;\r\n\r\n        this.stage.addChild(this.bg1, this.bg2, this.bg3, this.bg4);\r\n        this.stage.addChild(this.camera);\r\n\r\n        // this.debug= new PIXI.Graphics();\r\n        // this.camera.addChild(this.debug);\r\n\r\n        // this.debugText = new PIXI.Text('DEBUG', {fontFamily:\"arial\", fontSize: \"100px\", fill:\"white\"});\r\n        // this.debugText.anchor.set(0.5, 0.5);\r\n        // this.debugText.x = this.gameEngine.worldSettings.width/2;\r\n        // this.debugText.y = this.gameEngine.worldSettings.height/2;\r\n        // this.camera.addChild(this.debugText);\r\n\r\n        this.elapsedTime = Date.now();\r\n        // debug\r\n        if ('showworldbounds' in Utils.getUrlVars()) {\r\n            let graphics = new PIXI.Graphics();\r\n            graphics.beginFill(0xFFFFFF);\r\n            graphics.alpha = 0.1;\r\n            graphics.drawRect(0, 0, this.gameEngine.worldSettings.width, this.gameEngine.worldSettings.height);\r\n            this.camera.addChild(graphics);\r\n        }\r\n\r\n    }\r\n\r\n    setRendererSize() {\r\n        this.viewportWidth = window.innerWidth;\r\n        this.viewportHeight = window.innerHeight;\r\n\r\n        this.bg1.width = this.viewportWidth;\r\n        this.bg1.height = this.viewportHeight;\r\n        this.bg2.width = this.viewportWidth;\r\n        this.bg2.height = this.viewportHeight;\r\n        this.bg3.width = this.viewportWidth;\r\n        this.bg3.height = this.viewportHeight;\r\n        this.bg4.width = this.viewportWidth;\r\n        this.bg4.height = this.viewportHeight;\r\n\r\n        this.renderer.resize(this.viewportWidth, this.viewportHeight);\r\n    }\r\n\r\n    draw(t, dt) {\r\n        super.draw(t, dt);\r\n\r\n        let now = Date.now();\r\n\r\n        if (!this.isReady) return; // assets might not have been loaded yet\r\n        let worldWidth = this.gameEngine.worldSettings.width;\r\n        let worldHeight = this.gameEngine.worldSettings.height;\r\n\r\n        let viewportSeesRightBound = this.camera.x < this.viewportWidth - worldWidth;\r\n        let viewportSeesLeftBound = this.camera.x > 0;\r\n        let viewportSeesTopBound = this.camera.y > 0;\r\n        let viewportSeesBottomBound = this.camera.y < this.viewportHeight - worldHeight;\r\n\r\n        for (let objId of Object.keys(this.sprites)) {\r\n            let objData = this.gameEngine.world.objects[objId];\r\n            let sprite = this.sprites[objId];\r\n\r\n            if (objData) {\r\n\r\n                // if the object requests a \"showThrust\" then invoke it in the actor\r\n                if (sprite.actor && sprite.actor.thrustEmitter) {\r\n                    sprite.actor.thrustEmitter.emit = !!objData.showThrust;\r\n                }\r\n\r\n                if (objData instanceof Ship && sprite != this.playerShip) {\r\n                    this.updateOffscreenIndicator(objData);\r\n                }\r\n\r\n                sprite.x = objData.position.x;\r\n                sprite.y = objData.position.y;\r\n\r\n                if (objData instanceof Ship){\r\n                    sprite.actor.shipContainerSprite.rotation = this.gameEngine.world.objects[objId].angle * Math.PI/180;\r\n                } else{\r\n                    sprite.rotation = this.gameEngine.world.objects[objId].angle * Math.PI/180;\r\n                }\r\n\r\n                // make the wraparound seamless for objects other than the player ship\r\n                if (sprite != this.playerShip && viewportSeesLeftBound && objData.position.x > this.viewportWidth - this.camera.x) {\r\n                    sprite.x = objData.position.x - worldWidth;\r\n                }\r\n                if (sprite != this.playerShip && viewportSeesRightBound && objData.position.x < -this.camera.x) {\r\n                    sprite.x = objData.position.x + worldWidth;\r\n                }\r\n                if (sprite != this.playerShip && viewportSeesTopBound && objData.position.y > this.viewportHeight - this.camera.y) {\r\n                    sprite.y = objData.position.y - worldHeight;\r\n                }\r\n                if (sprite != this.playerShip && viewportSeesBottomBound && objData.position.y < -this.camera.y) {\r\n                    sprite.y = objData.position.y + worldHeight;\r\n                }\r\n            }\r\n\r\n            if (sprite) {\r\n                // object is either a Pixi sprite or an Actor. Actors have renderSteps\r\n                if (sprite.actor && sprite.actor.renderStep) {\r\n                    sprite.actor.renderStep(now - this.elapsedTime);\r\n                }\r\n            }\r\n\r\n            // this.emit(\"postDraw\");\r\n        }\r\n\r\n        let cameraTarget;\r\n        if (this.playerShip) {\r\n            cameraTarget = this.playerShip;\r\n            // this.cameraRoam = false;\r\n        } else if (!this.gameStarted && !cameraTarget) {\r\n\r\n            // calculate centroid\r\n            cameraTarget = getCentroid(this.gameEngine.world.objects);\r\n            this.cameraRoam = true;\r\n        }\r\n\r\n        if (cameraTarget) {\r\n            // let bgOffsetX = -this.bgPhaseX * worldWidth - cameraTarget.x;\r\n            // let bgOffsetY = -this.bgPhaseY * worldHeight - cameraTarget.y;\r\n\r\n            // 'cameraroam' in Utils.getUrlVars()\r\n            if (this.cameraRoam) {\r\n                let lookingAtDeltaX = cameraTarget.x - this.lookingAt.x;\r\n                let lookingAtDeltaY = cameraTarget.y - this.lookingAt.y;\r\n                let cameraTempTargetX;\r\n                let cameraTempTargetY;\r\n\r\n                if (lookingAtDeltaX > worldWidth / 2) {\r\n                    this.bgPhaseX++;\r\n                    cameraTempTargetX = this.lookingAt.x + worldWidth;\r\n                } else if (lookingAtDeltaX < -worldWidth / 2) {\r\n                    this.bgPhaseX--;\r\n                    cameraTempTargetX = this.lookingAt.x - worldWidth;\r\n                } else {\r\n                    cameraTempTargetX = this.lookingAt.x + lookingAtDeltaX * 0.02;\r\n                }\r\n\r\n                if (lookingAtDeltaY > worldHeight / 2) {\r\n                    cameraTempTargetY = this.lookingAt.y + worldHeight;\r\n                    this.bgPhaseY++;\r\n                } else if (lookingAtDeltaY < -worldHeight / 2) {\r\n                    this.bgPhaseY--;\r\n                    cameraTempTargetY = this.lookingAt.y - worldHeight;\r\n                } else {\r\n                    cameraTempTargetY = this.lookingAt.y + lookingAtDeltaY * 0.02;\r\n                }\r\n\r\n                this.centerCamera(cameraTempTargetX, cameraTempTargetY);\r\n\r\n            } else {\r\n                this.centerCamera(cameraTarget.x, cameraTarget.y);\r\n            }\r\n        }\r\n\r\n        let bgOffsetX = this.bgPhaseX * worldWidth + this.camera.x;\r\n        let bgOffsetY = this.bgPhaseY * worldHeight + this.camera.y;\r\n\r\n        this.bg1.tilePosition.x = bgOffsetX * 0.01;\r\n        this.bg1.tilePosition.y = bgOffsetY * 0.01;\r\n\r\n        this.bg2.tilePosition.x = bgOffsetX * 0.04;\r\n        this.bg2.tilePosition.y = bgOffsetY * 0.04;\r\n\r\n        this.bg3.tilePosition.x = bgOffsetX * 0.3;\r\n        this.bg3.tilePosition.y = bgOffsetY * 0.3;\r\n\r\n        this.bg4.tilePosition.x = bgOffsetX * 0.75;\r\n        this.bg4.tilePosition.y = bgOffsetY * 0.75;\r\n\r\n        this.elapsedTime = now;\r\n\r\n        // Render the stage\r\n        this.renderer.render(this.stage);\r\n    }\r\n\r\n    addPlayerShip(sprite) {\r\n        this.playerShip = sprite;\r\n        sprite.actor.shipSprite.tint = 0XFF00FF; // color  player ship\r\n        document.body.classList.remove('lostGame');\r\n        if (!document.body.classList.contains('tutorialDone')){\r\n            document.body.classList.add('tutorial');\r\n        }\r\n        document.body.classList.remove('lostGame');\r\n        document.body.classList.add('gameActive');\r\n        document.querySelector('#tryAgain').disabled = true;\r\n        document.querySelector('#joinGame').disabled = true;\r\n        document.querySelector('#joinGame').style.opacity = 0;\r\n\r\n        this.gameStarted = true; // todo state shouldn't be saved in the renderer\r\n\r\n        // remove the tutorial if required after a timeout\r\n        setTimeout(() => {\r\n            document.body.classList.remove('tutorial');\r\n        }, 10000);\r\n    }\r\n\r\n    /**\r\n     * Centers the viewport on a coordinate in the gameworld\r\n     * @param {Number} targetX\r\n     * @param {Number} targetY\r\n     */\r\n    centerCamera(targetX, targetY) {\r\n        if (isNaN(targetX) || isNaN(targetY)) return;\r\n        if (!this.lastCameraPosition){\r\n            this.lastCameraPosition = {};\r\n        }\r\n\r\n        this.lastCameraPosition.x = this.camera.x;\r\n        this.lastCameraPosition.y = this.camera.y;\r\n\r\n        this.camera.x = this.viewportWidth / 2 - targetX;\r\n        this.camera.y = this.viewportHeight / 2 - targetY;\r\n        this.lookingAt.x = targetX;\r\n        this.lookingAt.y = targetY;\r\n    }\r\n\r\n    addOffscreenIndicator(objData) {\r\n        let container = document.querySelector('#offscreenIndicatorContainer');\r\n        let indicatorEl = document.createElement('div');\r\n        indicatorEl.setAttribute('id', 'offscreenIndicator' + objData.id);\r\n        indicatorEl.classList.add('offscreenIndicator');\r\n        container.appendChild(indicatorEl);\r\n    }\r\n\r\n    updateOffscreenIndicator(objData){\r\n        // player ship might have been destroyed\r\n        if (!this.playerShip) return;\r\n\r\n        let indicatorEl = document.querySelector('#offscreenIndicator' + objData.id);\r\n        if (!indicatorEl) {\r\n            console.error(`No indicatorEl found with id ${objData.id}`);\r\n            return;\r\n        }\r\n        let playerShipObj = this.gameEngine.world.objects[this.playerShip.id];\r\n        let slope = (objData.position.y - playerShipObj.position.y) / (objData.position.x - playerShipObj.position.x);\r\n        let b = this.viewportHeight/ 2;\r\n\r\n        let padding = 30;\r\n        let indicatorPos = { x: 0, y: 0 };\r\n\r\n        if (objData.position.y < playerShipObj.position.y - this.viewportHeight/2) {\r\n            indicatorPos.x = this.viewportWidth/2 + (padding - b)/slope;\r\n            indicatorPos.y = padding;\r\n        } else if (objData.position.y > playerShipObj.position.y + this.viewportHeight/2) {\r\n            indicatorPos.x = this.viewportWidth/2 + (this.viewportHeight - padding - b)/slope;\r\n            indicatorPos.y = this.viewportHeight - padding;\r\n        }\r\n\r\n        if (objData.position.x < playerShipObj.position.x - this.viewportWidth/2) {\r\n            indicatorPos.x = padding;\r\n            indicatorPos.y = slope * (-this.viewportWidth/2 + padding) + b;\r\n        } else if (objData.position.x > playerShipObj.position.x + this.viewportWidth/2) {\r\n            indicatorPos.x = this.viewportWidth - padding;\r\n            indicatorPos.y = slope * (this.viewportWidth/2 - padding) + b;\r\n        }\r\n\r\n        if (indicatorPos.x == 0 && indicatorPos.y == 0){\r\n            indicatorEl.style.opacity = 0;\r\n        } else {\r\n            indicatorEl.style.opacity = 1;\r\n            let rotation = Math.atan2(objData.position.y - playerShipObj.position.y, objData.position.x - playerShipObj.position.x);\r\n            rotation = rotation * 180/Math.PI; // rad2deg\r\n            indicatorEl.style.transform = `translateX(${indicatorPos.x}px) translateY(${indicatorPos.y}px) rotate(${rotation}deg) `;\r\n        }\r\n    }\r\n\r\n    removeOffscreenIndicator(objData) {\r\n        let indicatorEl = document.querySelector('#offscreenIndicator'+objData.id);\r\n        if (indicatorEl && indicatorEl.parentNode)\r\n            indicatorEl.parentNode.removeChild(indicatorEl);\r\n    }\r\n\r\n    updateHUD(data){\r\n        if (data.RTT){ qs('.latencyData').innerHTML = data.RTT;}\r\n        if (data.RTTAverage){ qs('.averageLatencyData').innerHTML = truncateDecimals(data.RTTAverage, 2);}\r\n    }\r\n\r\n    updateScore(data){\r\n        let scoreContainer = qs('.score');\r\n        let scoreArray = [];\r\n\r\n        // remove score lines with objects that don't exist anymore\r\n        let scoreEls = scoreContainer.querySelectorAll('.line');\r\n        for (let x=0; x < scoreEls.length; x++){\r\n            if (data[scoreEls[x].dataset.objId] == null){\r\n                scoreEls[x].parentNode.removeChild(scoreEls[x]);\r\n            }\r\n        }\r\n\r\n        for (let id of Object.keys(data)){\r\n            let scoreEl = scoreContainer.querySelector(`[data-obj-id='${id}']`);\r\n            // create score line if it doesn't exist\r\n            if (scoreEl == null){\r\n                scoreEl = document.createElement('div');\r\n                scoreEl.classList.add('line');\r\n                if (this.playerShip && this.playerShip.id == parseInt(id)) scoreEl.classList.add('you');\r\n                scoreEl.dataset.objId = id;\r\n                scoreContainer.appendChild(scoreEl);\r\n            }\r\n\r\n            // stupid string/number conversion\r\n            if (this.sprites[parseInt(id)])\r\n                this.sprites[parseInt(id)].actor.changeName(data[id].name);\r\n\r\n            scoreEl.innerHTML = `${data[id].name}: ${data[id].kills}`;\r\n\r\n            scoreArray.push({\r\n                el: scoreEl,\r\n                data: data[id]\r\n            });\r\n        }\r\n\r\n        scoreArray.sort((a, b) => {return a.data.kills < b.data.kills;});\r\n\r\n        for (let x=0; x < scoreArray.length; x++){\r\n            scoreArray[x].el.style.transform = `translateY(${x}rem)`;\r\n        }\r\n\r\n    }\r\n\r\n    onKeyChange(e){\r\n        if (this.playerShip) {\r\n            if (e.keyName === 'up') {\r\n                this.playerShip.actor.thrustEmitter.emit = e.isDown;\r\n            }\r\n        }\r\n    }\r\n\r\n    enableFullScreen(){\r\n        let isInFullScreen = (document.fullScreenElement && document.fullScreenElement !== null) ||    // alternative standard method\r\n            (document.mozFullScreen || document.webkitIsFullScreen);\r\n\r\n        // iOS fullscreen generates user warnings\r\n        if (isIPhoneIPad()) return;\r\n\r\n        let docElm = document.documentElement;\r\n        if (!isInFullScreen) {\r\n\r\n            if (docElm.requestFullscreen) {\r\n                docElm.requestFullscreen();\r\n            } else if (docElm.mozRequestFullScreen) {\r\n                docElm.mozRequestFullScreen();\r\n            } else if (docElm.webkitRequestFullScreen) {\r\n                // NOTE: disabled on iOS/Safari, because it generated a\r\n                // phishing warning.\r\n                // docElm.webkitRequestFullScreen();\r\n            }\r\n        }\r\n    }\r\n\r\n    /*\r\n     * Takes in game coordinates and translates them into screen coordinates\r\n     * @param obj an object with x and y properties\r\n     */\r\n    gameCoordsToScreen(obj){\r\n        // console.log(obj.x , this.viewportWidth / 2 , this.camera.x)\r\n        return {\r\n            x: obj.position.x + this.camera.x,\r\n            y: obj.position.y + this.camera.y\r\n        };\r\n    }\r\n\r\n}\r\n\r\nfunction getCentroid(objects) {\r\n    let maxDistance = 500; // max distance to add to the centroid\r\n    let shipCount = 0;\r\n    let centroid = { x: 0, y: 0 };\r\n    let selectedShip = null;\r\n\r\n    for (let id of Object.keys(objects)){\r\n        let obj = objects[id];\r\n        if (obj instanceof Ship) {\r\n            if (selectedShip == null)\r\n                selectedShip = obj;\r\n\r\n            let objDistance = Math.sqrt( Math.pow((selectedShip.position.x-obj.position.y), 2) + Math.pow((selectedShip.position.y-obj.position.y), 2));\r\n            if (selectedShip == obj || objDistance < maxDistance) {\r\n                centroid.x += obj.position.x;\r\n                centroid.y += obj.position.y;\r\n                shipCount++;\r\n            }\r\n        }\r\n    }\r\n\r\n    centroid.x /= shipCount;\r\n    centroid.y /= shipCount;\r\n\r\n\r\n    return centroid;\r\n}\r\n\r\n// convenience function\r\nfunction qs(selector) { return document.querySelector(selector);}\r\n\r\nfunction truncateDecimals(number, digits) {\r\n    let multiplier = Math.pow(10, digits);\r\n    let adjustedNum = number * multiplier;\r\n    let truncatedNum = Math[adjustedNum < 0 ? 'ceil' : 'floor'](adjustedNum);\r\n\r\n    return truncatedNum / multiplier;\r\n};\r\n\r\nfunction isMacintosh() {\r\n    return navigator.platform.indexOf('Mac') > -1;\r\n}\r\n\r\nfunction isWindows() {\r\n    return navigator.platform.indexOf('Win') > -1;\r\n}\r\n\r\nfunction isIPhoneIPad() {\r\n    return navigator.platform.match(/i(Phone|Pod)/i) !== null;\r\n}\r\n"],"file":"SpaaaceRenderer.js"}
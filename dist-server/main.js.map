{"version":3,"sources":["../src/main.js"],"names":["express","require","socketIO","path","PORT","process","env","INDEX","join","__dirname","server","requestHandler","listen","console","log","io","gameEngine","SpaaaceGameEngine","traceLevel","serverEngine","SpaaaceServerEngine","debug","updateRate","timeoutInterval","get","req","res","sendFile","queueInputForPlayer","query","Number","id","gameObjects","Object","keys","world","objects","element","type","playerShip","playerId","gameObject","position","angle","gameFieldWidth","worldSettings","width","gameFieldHeight","height","step","stepCount","push","send","use","start"],"mappings":"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","sourcesContent":["const express = require('express');\r\nconst socketIO = require('socket.io');\r\nconst path = require('path');\r\nimport { Lib } from 'lance-gg';\r\n\r\nconst PORT = process.env.PORT || 3000;\r\nconst INDEX = path.join(__dirname, '../dist/index.html');\r\n\r\n// Game Server\r\nimport SpaaaceServerEngine from './server/SpaaaceServerEngine.js';\r\nimport SpaaaceGameEngine from './common/SpaaaceGameEngine.js';\r\n\r\n// define routes and socket\r\nconst server = express();\r\n\r\nlet requestHandler = server.listen(PORT, () => console.log(`Listening on ${ PORT }`));\r\nconst io = socketIO(requestHandler);\r\n\r\n// Game Instances\r\nconst gameEngine = new SpaaaceGameEngine({ traceLevel: 0 });\r\nconst serverEngine = new SpaaaceServerEngine(io, gameEngine, {\r\n    debug: {},\r\n    updateRate: 6,\r\n    // stepRate: 60,\r\n    timeoutInterval: 0 // no timeout\r\n});\r\n\r\n\r\nserver.get('/', function(req, res) { res.sendFile(INDEX); });\r\nserver.get('/api', function(req, res) {\r\n    //ar InputData = { input: \"up\" };\r\n\r\n    serverEngine.queueInputForPlayer(req.query, Number(req.query.id))\r\n        //gameEngine.processInput(req.query, Number(req.query.id));\r\n\r\n    let gameObjects = [];\r\n\r\n    for (let element of Object.keys(gameEngine.world.objects)) {\r\n\r\n        let type = \"\";\r\n\r\n        let playerShip = gameEngine.world.objects[element];\r\n\r\n        if (playerShip.playerId != req.query.id) {\r\n            type = \"Enemy\";\r\n        } else {\r\n            type = \"Me\";\r\n        }\r\n\r\n        let gameObject = {\r\n            position: playerShip.position,\r\n            type: type,\r\n            id: playerShip.id,\r\n            angle: playerShip.angle,\r\n            gameFieldWidth: gameEngine.worldSettings.width,\r\n            gameFieldHeight: gameEngine.worldSettings.height,\r\n            step: gameEngine.world.stepCount\r\n        }\r\n\r\n        gameObjects.push(gameObject);\r\n\r\n    }\r\n\r\n    res.send(gameObjects);\r\n});\r\nserver.use('/', express.static(path.join(__dirname, '../dist/')));\r\n\r\n\r\n// start the game\r\nserverEngine.start();"],"file":"main.js"}